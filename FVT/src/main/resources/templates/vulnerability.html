<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{default}">
<head>
<meta charset="UTF-8">
<title th:text="#{title.vulnerabilities}"></title>
</head>
<body>
	<div layout:fragment="content">

		<!-- top filters and buttons -->

		<!-- Year filter -->
		<div class="container-flex right-align mb-2">
			<div class="row justify-content-end">
				<form th:action="@{/vulnerability/search}"
					th:object="${searchVulForm}" method="post" class="col-4">
					<div class="row mr-3">
						<div class="col-8 pr-0">
							<input type="text" class="form-control" name="search"
								maxlength="50" th:value="${searchVulForm.search}"
								th:placeholder="#{placeholder.vulnerability.search}">
						</div>
						<div class="col-3 center-align">
							<select class="selectpicker" th:field="*{year}"
								th:value="${searchVulForm.year}">
								<option th:each="year: ${years}" th:value="${year}"
									th:text="${year}"></option>
							</select>
						</div>
						<div class="p-1">
							<button type="submit" class="btn btn-link p-0"
								data-toggle="tooltip" data-placement="bottom"
								th:attr="title=#{tooltip.search.vulnerability}">
								<img th:src="@{/images/search_64px.png}" width="25" height="25" />
							</button>
						</div>
					</div>
				</form>
				<div class="p-1 mr-3"
					th:if="${searchVulForm.search != null or searchVulForm.year != null}">
					<span data-toggle="tooltip" data-placement="bottom"
						th:attr="title=#{tooltip.clean.filter.vulnerability}"> <a
						th:href="@{/vulnerability/search/clean}"><input class="ml-2"
							type="image" th:src="@{/images/remove2_64px.png}" width="25"
							height="25" /> </a>
					</span>

				</div>
			</div>
		</div>

		<div class="container center-align mb-2"
			th:if="${vulsPage.totalPages > 0}">
			<!-- Previous button -->
			<a class="page-link"
				th:if="${searchVulForm.search == null and searchVulForm.year == null}"
				th:href="@{/vulnerability(size=${vulsPage.size}, page=${vulsPage.number})}"
				th:class="${pageNumber==vulsPage.number} ? active"><button
					th:disabled="${vulsPage.number < 1}" type="button"
					class="btn btn-secondary" th:text="#{button.previous}"></button></a>

			<!-- search previous -->
			<a class="page-link"
				th:if="${searchVulForm.search != null or searchVulForm.year != null}"
				th:href="@{/vulnerability/search(size=${vulsPage.size}, page=${vulsPage.number})}"
				th:class="${pageNumber==vulsPage.number} ? active"><button
					th:disabled="${vulsPage.number < 1}" type="button"
					class="btn btn-secondary" th:text="#{button.previous}"></button></a>

			<!-- next button -->
			<a class="page-link"
				th:if="${searchVulForm.search == null and searchVulForm.year == null}"
				th:href="@{/vulnerability(size=${vulsPage.size}, page=${vulsPage.number + 2})}"
				th:class="${pageNumber==vulsPage.number + 2} ? active"><button
					th:disabled="${vulsPage.number + 2 > vulsPage.totalPages}"
					type="button" class="btn btn-primary" th:text="#{button.next}"></button></a>

			<!-- search next -->
			<a class="page-link"
				th:if="${searchVulForm.search != null or searchVulForm.year != null}"
				th:href="@{/vulnerability/search(size=${vulsPage.size}, page=${vulsPage.number + 2})}"
				th:class="${pageNumber==vulsPage.number + 2} ? active"><button
					th:disabled="${vulsPage.number + 2 > vulsPage.totalPages}"
					type="button" class="btn btn-primary" th:text="#{button.next}"></button></a>
		</div>

		<!-- vulnerabilities pages table -->
		<table class="table">
			<thead class="table-heading-custom">
				<tr>
					<th class="col-3" scope="col" th:text="#{table.header.name}" />
					<th class="col-7" scope="col" th:text="#{table.header.description}" />
					<th class="col-2 center-align" scope="col"
						th:text="#{table.header.Operations}" />
				</tr>
			</thead>
			<tbody>
				<tr class="d-flex" th:if="${not vulsPage.hasContent()}">
					<td class="col-12 center-align" th:text="#{general.empty.table2}"></td>
				</tr>
				<tr th:if="${vulsPage != null}"
					th:each="vul, iStat : ${vulsPage.content}">
					<th class="col-3" scope="row" th:text="${vul.name}" />
					<td class="col-7" th:text="${vul.description}" />
					<td class="col-2">
						<div class="container form-inline justify-content-center">
							<span data-toggle="tooltip" data-placement="bottom"
								th:attr="title=#{tooltip.show.vulnerability}"> <input
								type="image" src="/images/look_64px.png" data-toggle="modal"
								th:attr="data-target='#showVulnerabilityModal'+${vul.id}"
								width="25" height="25" />
							</span> <span data-toggle="tooltip" data-placement="bottom"
								th:attr="title=#{tooltip.show.references}"> <input
								class="ml-2" th:if="${not #lists.isEmpty(vul.references)}"
								type="image" src="/images/link_64px.png" data-toggle="modal"
								th:attr="data-target='#showVulnerabilityRefsModal'+${vul.id}"
								width="25" height="25" />
							</span>

							<!-- Show vulnerability modal -->
							<div class="modal fade"
								th:attr="id='showVulnerabilityModal'+${vul.id}" tabindex="-1"
								role="dialog" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered modal-lg"
									role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title"
												th:text="#{modal.header.show.vulnerability}"></h5>
											<button type="button" class="close" data-dismiss="modal"
												aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<table class="table borderless">
												<thead></thead>
												<tbody>
													<tr class="d-flex">
														<th class="col-5" th:text="#{label.name}"></th>
														<td class="col-7" th:text="${vul.name}"></td>
													</tr>
													<tr class="d-flex">
														<th class="col-5" th:text="#{label.vul.sequence}"></th>
														<td class="col-7" th:text="${vul.seq}"></td>
													</tr>
													<tr class="d-flex">
														<th class="col-5" th:text="#{label.vul.description}"></th>
														<td class="col-7" th:text="${vul.description}"></td>
													</tr>
													<tr class="d-flex"
														th:if="${not #lists.isEmpty(vul.references)}">
														<th class="col-5" th:text="#{label.vul.refs.number}"></th>
														<td class="col-7" th:text="${#lists.size(vul.references)}"></td>
													</tr>

												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>

							<!-- Show vulnerability references modal -->
							<div class="modal fade"
								th:attr="id='showVulnerabilityRefsModal'+${vul.id}"
								tabindex="-1" role="dialog" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered modal-lg"
									role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title"
												th:text="#{modal.header.show.vulnerability.refs}"></h5>
											<button type="button" class="close" data-dismiss="modal"
												aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<table class="table borderless">
												<thead></thead>
												<tbody>
													<tr class="d-flex"
														th:if="${#lists.isEmpty(vul.references)}">
														<th class="col-12" th:text="#{label.vul.no.refs}"></th>
													</tr>
													<tr class="d-flex"
														th:if="${not #lists.isEmpty(vul.references)}">
														<th class="col-6" th:text="#{label.vul.refs.url}"></th>
														<th class="col-6" th:text="#{label.vul.refs.desc}"></th>
													</tr>
													<tr class="d-flex"
														th:if="${not #lists.isEmpty(vul.references)}"
														th:each="ref: ${vul.references}">
														<td class="col-6"><a th:href="@{${ref.url}}"
															th:text="${ref.url}"></a></td>
														<td class="col-6" th:text="${ref.description}"></td>
													</tr>

												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</td>
				</tr>
			</tbody>
		</table>

		<!-- pagination buttons -->
		<!-- Previous button -->
		<div class="container center-align" th:if="${vulsPage.totalPages > 0}">
			<!-- Previous button -->
			<a class="page-link"
				th:if="${searchVulForm.search == null and searchVulForm.year == null}"
				th:href="@{/vulnerability(size=${vulsPage.size}, page=${vulsPage.number})}"
				th:class="${pageNumber==vulsPage.number} ? active"><button
					th:disabled="${vulsPage.number < 1}" type="button"
					class="btn btn-secondary" th:text="#{button.previous}"></button></a>

			<!-- search previous -->
			<a class="page-link"
				th:if="${searchVulForm.search != null or searchVulForm.year != null}"
				th:href="@{/vulnerability/search(size=${vulsPage.size}, page=${vulsPage.number})}"
				th:class="${pageNumber==vulsPage.number} ? active"><button
					th:disabled="${vulsPage.number < 1}" type="button"
					class="btn btn-secondary" th:text="#{button.previous}"></button></a>

			<!-- next button -->
			<a class="page-link"
				th:if="${searchVulForm.search == null and searchVulForm.year == null}"
				th:href="@{/vulnerability(size=${vulsPage.size}, page=${vulsPage.number + 2})}"
				th:class="${pageNumber==vulsPage.number + 2} ? active"><button
					th:disabled="${vulsPage.number + 2 > vulsPage.totalPages}"
					type="button" class="btn btn-primary" th:text="#{button.next}"></button></a>

			<!-- search next -->
			<a class="page-link"
				th:if="${searchVulForm.search != null or searchVulForm.year != null}"
				th:href="@{/vulnerability/search(size=${vulsPage.size}, page=${vulsPage.number + 2})}"
				th:class="${pageNumber==vulsPage.number + 2} ? active"><button
					th:disabled="${vulsPage.number + 2 > vulsPage.totalPages}"
					type="button" class="btn btn-primary" th:text="#{button.next}"></button></a>
		</div>
	</div>
</body>
</html>